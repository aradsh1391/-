from pydantic import BaseModel, Field, ValidationError
import csv
from typing import List

# Define a Pydantic model for CSV row validation
class ProductData(BaseModel):
    product_id: int = Field(..., ge=1, description="Product ID must be a positive integer")
    price: float = Field(..., ge=0, le=10000, description="Price must be between 0 and 10,000")
    quantity: int = Field(..., ge=0, description="Quantity must be a non-negative integer")

def validate_csv(file_path: str) -> List[ProductData]:
    validated_rows = []
    with open(file_path, newline='', encoding='utf-8') as csvfile:
        reader = csv.DictReader(csvfile)
        for row_number, row in enumerate(reader, start=1):
            try:
                # Convert strings to appropriate types before validation
                row_data = {
                    "product_id": int(row["product_id"]),
                    "price": float(row["price"]),
                    "quantity": int(row["quantity"])
                }
                validated_row = ProductData(**row_data)
                validated_rows.append(validated_row)
            except (ValueError, ValidationError) as e:
                print(f"Row {row_number} validation error: {e}")
    return validated_rows

if __name__ == "__main__":
    # Example CSV file path
    csv_file = "products.csv"

    # Example CSV content:
    # product_id,price,quantity
    # 1,19.99,5
    # 2,250.50,10
    # 3,-5,2   <-- This will fail validation (negative price)

    validated_data = validate_csv(csv_file)
    print("\nValidated Data:")
    for item in validated_data:
        print(item.model_dump())
